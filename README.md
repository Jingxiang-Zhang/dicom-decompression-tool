# DICOM Decompression Tool

This script decompresses DICOM files, ensuring metadata consistency and compatibility with most DICOM viewers, including Slicer3D. It uses a combination of **pydicom** (for metadata handling) and **SimpleITK** (for pixel data decompression) to overcome limitations of each library.

------

## Features

- **Decompress DICOM files**: Handles compressed formats such as JPEG, JPEG-LS, JPEG 2000, and RLE.
- **Preserve metadata**: Maintains critical DICOM metadata to ensure slices remain part of the same series.
- **Compatibility**: Generates DICOM files readable by common DICOM viewers (e.g., Slicer3D, RadiAnt).
- **Customizable output**: Overwrite original files or save decompressed files to a specified output directory.
- **Verbose mode**: Enable detailed logging for debugging.

------

## Why This Tool?

### Limitations of Existing Libraries

1. **pydicom**:
   - Cannot load compressed pixel data even in its latest version (3.0).
   - Designed primarily for metadata handling, not pixel data decompression.
2. **SimpleITK**:
   - Can decompress pixel data but does not preserve critical metadata required by DICOM viewers.

### Solution

This tool combines **pydicom** (to handle metadata) and **SimpleITK** (to decompress pixel data). By combining the strengths of both libraries, the tool ensures proper decompression and metadata preservation.

------

## Installation

### Prerequisites

- Python 3.7 or higher
- Install required libraries:

```bash
pip install pydicom SimpleITK
```

------

## Usage

### Command-Line Arguments

```bash
python decompress_dicom.py -i <input_dir> [-o <output_dir>] [-v]
```

| Argument           | Description                                                  |
| ------------------ | ------------------------------------------------------------ |
| `-i, --input_dir`  | **Required**. Path to the input folder containing DICOM files. |
| `-o, --output_dir` | **Optional**. Path to the output folder. If not provided, files are overwritten in-place. |
| `-v, --verbose`    | **Optional**. Enable verbose output for detailed debugging information. |

### Notes

- Ensure that the paths provided (`input_dir` and `output_dir`) **do not contain non-ASCII characters** (e.g., Chinese characters). These characters may cause issues with file handling.
- The script automatically detects compressed DICOM files and decompresses only those files.

------

### Examples

#### Decompress and Overwrite in Place

```bash
python decompress_dicom.py -i /path/to/dicom/folder
```

#### Decompress and Save to a New Folder

```bash
python decompress_dicom.py -i /path/to/dicom/folder -o /path/to/output/folder
```

#### Enable Verbose Output

```bash
python decompress_dicom.py -i /path/to/dicom/folder -v
```

------

## Supported Compressed Formats

The script supports the following compressed DICOM formats:

- **JPEG** (Lossy and Lossless)
- **JPEG 2000** (Lossy and Lossless)
- **JPEG-LS**
- **RLE** (Run-Length Encoding)
- **MPEG** (for video data)

------

## How It Works

1. **Detect Compression**:
   - The script uses **pydicom** to check the `TransferSyntaxUID` of each file to identify compressed formats.
2. **Decompress Pixel Data**:
   - Compressed pixel data is decompressed using **SimpleITK**.
3. **Preserve Metadata**:
   - Critical DICOM tags (e.g., `SeriesInstanceUID`, `ImagePositionPatient`) are retained or updated to ensure consistency.
4. **Save Decompressed Files**:
   - The decompressed files are saved with an uncompressed `TransferSyntaxUID` (`ExplicitVRLittleEndian`).

------

## Known Issues and Limitations

1. **Path Issues**:
   - Non-ASCII characters in file paths (e.g., Chinese, Japanese) may cause errors during processing. Use only ASCII characters in paths.
2. **Viewer Compatibility**:
   - Files generated by this tool are compatible with most DICOM viewers. However, custom or proprietary formats may require additional handling.

------

## License

This tool is open-source and distributed under the MIT License. Contributions and feedback are welcome!